<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>HypixelStats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: system-ui, Arial; margin: 2rem; background: #0b1220; color: #e9eefc; }
    input, button { padding: 0.5rem; border-radius: 8px; border: 1px solid #555; }
    button { background: #62d0ff; color: #000; font-weight: bold; cursor: pointer; }
    .card { border: 1px solid #333; border-radius: 12px; padding: 16px; margin: 12px 0; background:#121a2e; }
    h1 { color: #ffd166; }
    h2 { margin-top:0; color:#62d0ff; }
  </style>
</head>
<body>
  <h1>Stats Finder(tmp)</h1>
  <input id="ign" placeholder="Enter IGN" />
  <button id="go">Search</button>
  <div id="out"></div>

<script>
// ==================== LOOKUP TABLES ====================

// Skills
const SKILL_XP = [
  0, 50, 175, 375, 675, 1175, 1925, 2925, 4425, 6425,
  9925, 14925, 22425, 32425, 47425, 67425, 97425, 147425, 222425, 322425,
  522425, 822425, 1222425, 1722425, 2322425, 3022425, 3822425, 4722425, 5722425, 6822425,
  8022425, 9322425, 10722425, 12222425, 13822425, 15522425, 17322425, 19222425, 21222425, 23322425,
  25522425, 27822425, 30222425, 32722425, 35322425, 38022425, 40822425, 43722425, 46722425, 49822425,
  53022425, 56322425, 59722425, 63222425, 66822425, 70522425, 74322425, 78222425, 82222425, 86322425
];
function skillXpToLevel(xp) {
  let lvl = 0;
  for (let i = 0; i < SKILL_XP.length; i++) {
    if (xp >= SKILL_XP[i]) lvl = i;
    else break;
  }
  return lvl;
}

// Slayers
const SLAYER_XP = {
  zombie:    [0, 5, 15, 200, 1000, 5000, 20000, 100000, 400000, 1000000],
  spider:    [0, 5, 15, 200, 1000, 5000, 20000, 100000, 400000, 1000000],
  wolf:      [0, 5, 15, 200, 1500, 5000, 20000, 100000, 400000, 1000000],
  enderman:  [0, 10, 30, 250, 1500, 5000, 20000, 100000, 400000, 1000000],
  blaze:     [0, 10, 30, 250, 1500, 5000, 20000, 100000, 400000, 1000000]
};
function slayerXpToLevel(xp, type) {
  const reqs = SLAYER_XP[type] || [];
  let lvl = 0;
  for (let i = 0; i < reqs.length; i++) {
    if (xp >= reqs[i]) lvl = i;
    else break;
  }
  return lvl;
}

// HOTM
const HOTM_XP = [0, 0, 100, 250, 1000, 5000, 25000, 100000, 250000, 1000000];
function hotmXpToLevel(xp) {
  let lvl = 0;
  for (let i = 0; i < HOTM_XP.length; i++) {
    if (xp >= HOTM_XP[i]) lvl = i;
    else break;
  }
  return lvl;
}

// ==================== API + UTILS ====================

const API = "https://sparkling-mode-89ee.wsciteslf.workers.dev";

async function byNameToUuid(name){
  const r = await fetch(`https://playerdb.co/api/player/minecraft/${encodeURIComponent(name)}`);
  if (!r.ok) throw new Error("PlayerDB lookup failed");
  const j = await r.json();
  if (!j?.data?.player?.id) throw new Error("IGN not found");
  return j.data.player.id.replace(/-/g,"");
}

function xpToNetworkLevel(xp){
  // Official Hypixel network level formula
  return Math.floor((Math.sqrt((2 * xp) + 30625) / 50) - 2.5);
}

// ==================== MAIN LOOKUP ====================

async function lookup(){
  const ign = document.getElementById("ign").value.trim();
  const out = document.getElementById("out"); out.textContent = "Loading…";
  try{
    const uuid = await byNameToUuid(ign);

    const [player, status, guild, profiles] = await Promise.all([
      fetch(`${API}/api/player?uuid=${uuid}`).then(r=>r.json()),
      fetch(`${API}/api/status?uuid=${uuid}`).then(r=>r.json()),
      fetch(`${API}/api/guild?uuid=${uuid}`).then(r=>r.json()),
      fetch(`${API}/api/skyblock/profiles?uuid=${uuid}`).then(r=>r.json()),
    ]);

    const p = player.player ?? {};
    const g = guild.guild ?? {};
    const st = status.session ?? {};
    const prof = profiles.profiles?.find(x => x.selected) ?? profiles.profiles?.[0];
    const sb = prof?.members?.[uuid] ?? {};

    // Network level
    const networkLevel = xpToNetworkLevel(p.networkExp ?? 0);

    // Skills
    const farmingLevel = skillXpToLevel(sb.experience_skill_farming ?? 0);
    const miningLevel  = skillXpToLevel(sb.experience_skill_mining ?? 0);
    const combatLevel  = skillXpToLevel(sb.experience_skill_combat ?? 0);

    // Slayer levels
    const zombieSlayer   = slayerXpToLevel(sb.slayer_bosses?.zombie?.xp ?? 0, "zombie");
    const spiderSlayer   = slayerXpToLevel(sb.slayer_bosses?.spider?.xp ?? 0, "spider");
    const wolfSlayer     = slayerXpToLevel(sb.slayer_bosses?.wolf?.xp ?? 0, "wolf");
    const endermanSlayer = slayerXpToLevel(sb.slayer_bosses?.enderman?.xp ?? 0, "enderman");
    const blazeSlayer    = slayerXpToLevel(sb.slayer_bosses?.blaze?.xp ?? 0, "blaze");

    // HOTM
    const hotmLevel = hotmXpToLevel(sb.mining_core?.experience ?? 0);

    // Fairy souls
    const fairySouls = sb.fairy_souls_collected ?? 0;

    // Pets
    const pets = sb.pets ?? [];

    out.innerHTML = `
      <div class="card">
        <h2>General</h2>
        Name: ${p.displayname ?? ign}<br/>
        Rank: ${p.rank ?? p.newPackageRank ?? "—"}<br/>
        Network Level: ${networkLevel}<br/>
        Karma: ${p.karma ?? 0}
      </div>
      <div class="card">
        <h2>Status</h2>
        Online: ${st.online ? "Yes" : "No"}<br/>
        Game: ${st.gameType ?? "—"}<br/>
        Mode: ${st.mode ?? "—"}<br/>
        Map: ${st.map ?? "—"}
      </div>
      <div class="card">
        <h2>Guild</h2>
        Name: ${g.name ?? "—"}<br/>
        Tag: ${g.tag ?? "—"}
      </div>
      <div class="card">
        <h2>SkyBlock (${prof?.cute_name ?? "—"})</h2>
        Farming: ${farmingLevel}<br/>
        Mining: ${miningLevel}<br/>
        Combat: ${combatLevel}<br/>
        Fairy Souls: ${fairySouls}<br/>
        Slayer Lvls → Zombie: ${zombieSlayer}, Spider: ${spiderSlayer}, Wolf: ${wolfSlayer}, Enderman: ${endermanSlayer}, Blaze: ${blazeSlayer}<br/>
        HOTM Level: ${hotmLevel}<br/>
        Pets: ${pets.map(pet => pet.type + " (" + pet.tier + ")").join(", ") || "—"}
      </div>
    `;
  } catch(e){
    out.textContent = "Error: " + e;
  }
}

document.getElementById("go").onclick = lookup;
</script>
</body>
</html>
